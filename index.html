<body>
    <div class="container">
        <h1 class="text-2xl font-extrabold text-gray-800 mb-4">Datos de Google Sheets</h1>
        <p class="text-gray-600">Haz clic en el botón para cargar los datos de la hoja de cálculo.</p>
        <button id="testBtn" class="btn-test">Cargar Datos</button>
        <div id="statusMessage" class="message-box hidden"></div>
        
        <ul id="dataList" class="mt-4 p-4 border rounded-md bg-gray-50"></ul>
    </div>

    <script>
        // *** IMPORTANTE: Reemplaza esta URL con la NUEVA URL de tu despliegue ***
        const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/TU_NUEVA_URL_DE_DESPLIEGUE/exec';

        const testBtn = document.getElementById('testBtn');
        const statusMessage = document.getElementById('statusMessage');
        const dataList = document.getElementById('dataList');

        testBtn.addEventListener('click', async () => {
            statusMessage.classList.remove('hidden', 'success', 'error');
            statusMessage.classList.add('loading');
            statusMessage.textContent = 'Cargando datos...';
            dataList.innerHTML = ''; // Limpia la lista anterior

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {
                    method: 'GET',
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error(`Error HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Datos recibidos del servidor:', result);

                if (result.success) {
                    statusMessage.classList.remove('loading', 'error');
                    statusMessage.classList.add('success');
                    statusMessage.textContent = `¡Datos cargados con éxito! Se encontraron ${result.data.length} filas.`;

                    // Itera sobre los datos y los añade a la lista
                    result.data.forEach(row => {
                        const li = document.createElement('li');
                        li.textContent = row.join(', '); // Une las celdas de la fila con una coma
                        dataList.appendChild(li);
                    });
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Error al cargar los datos:', error);
                statusMessage.classList.remove('loading', 'success');
                statusMessage.classList.add('error');
                statusMessage.textContent = `Error: ${error.message || error}.`;
            }
        });
    </script>
</body>
